<div class="col-sm-12">
<div class="row">
  <div class="col-sm-8">
    <div class="panel panel-default">
      <div class="panel-heading">
        Photo
      </div>
        <div class="panel-body">
          <div class="col-sm-12">
             <%= image_tag @photo.image.normal.url, class: "img-responsive", id: "image" %>
          </div>
        </div>
        <div class="panel-footer text-center">
          <button id="save">Save</button>
        </div>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="panel panel-default">
      <div class="panel-heading">
      Opinions
      </div>
      <div class="panel-body">
        <div class="col-sm-12 js-pinch">
           <%= render @pinches %>
           <%= will_paginate @pinches %>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<script>
$(document).ready(function() {
  var $img = $("#image").imgNotes();

  $img.imgNotes({canEdit: true});
  var $export = $("#save");
  var $img = $("#image").imgNotes();
  var link = "<%= job_pinches_path(@job) %>";
  var photo_id = "<%= @photo.id %>";
  var job_id = "<%= @job.id %>";
  $export.on("click", function() {
    $img.imgNotes({canEdit: false});
    var $notes = $img.imgNotes('export'); 
    $img.imgNotes('clear');
    $img.imgNotes({canEdit: true});
      $notes.forEach(function(item) {
        $.ajax({
          type: "POST",
          url: link,
          data: {'pinch':item, 'photo_id':photo_id, 'job_id':job_id }
        });         
      });
    });
});
</script>
<% content_for :header do %>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" media="screen">
<% end %>
